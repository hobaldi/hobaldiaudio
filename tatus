[1mdiff --git a/core/audio/audio_engine.c b/core/audio/audio_engine.c[m
[1mindex 12499d7..8045231 100644[m
[1m--- a/core/audio/audio_engine.c[m
[1m+++ b/core/audio/audio_engine.c[m
[36m@@ -1,5 +1,6 @@[m
 #include "audio_engine.h"[m
[31m-#include "audio_ringbuf.h"[m
[32m+[m[32m#include "buffer/audio_ringbuf.h"[m
[32m+[m
 [m
 void audio_engine_init(audio_sink_t *out) {[m
     audio_rb_init(64 * 1024); // 64KB buffer (~170ms)[m
[1mdiff --git a/core/audio/audio_engine.h b/core/audio/audio_engine.h[m
[1mindex 708668f..bcbadc0 100644[m
[1m--- a/core/audio/audio_engine.h[m
[1m+++ b/core/audio/audio_engine.h[m
[36m@@ -1,44 +1,11 @@[m
[31m-#include "driver/i2s.h"[m
[31m-#include "audio_engine.h"[m
[31m-#include "freertos/FreeRTOS.h"[m
[31m-#include "freertos/task.h"[m
[32m+[m[32m#pragma once[m
[32m+[m[32m#include <stdint.h>[m
[32m+[m[32m#include <stddef.h>[m
 [m
[31m-#define I2S_NUM I2S_NUM_0[m
[32m+[m[32mstruct audio_sink;[m
[32m+[m[32mtypedef struct audio_sink audio_sink_t;[m
 [m
[31m-static void i2s_task(void *arg) {[m
[31m-    uint8_t buffer[1024];[m
[31m-    size_t bytes_read, bytes_written;[m
[31m-[m
[31m-    while (1) {[m
[31m-        bytes_read = audio_engine_read(buffer, sizeof(buffer));[m
[31m-        if (bytes_read > 0) {[m
[31m-            i2s_write(I2S_NUM, buffer, bytes_read, &bytes_written, portMAX_DELAY);[m
[31m-        }[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-void i2s_out_init(void) {[m
[31m-    i2s_config_t config = {[m
[31m-        .mode = I2S_MODE_MASTER | I2S_MODE_TX,[m
[31m-        .sample_rate = 44100,[m
[31m-        .bits_per_sample = I2S_BITS_PER_SAMPLE_16BIT,[m
[31m-        .channel_format = I2S_CHANNEL_FMT_RIGHT_LEFT,[m
[31m-        .communication_format = I2S_COMM_FORMAT_I2S,[m
[31m-        .dma_buf_count = 8,[m
[31m-        .dma_buf_len = 256,[m
[31m-        .use_apll = true,[m
[31m-    };[m
[31m-[m
[31m-    i2s_pin_config_t pins = {[m
[31m-        .bck_io_num = 26,[m
[31m-        .ws_io_num = 25,[m
[31m-        .data_out_num = 22,[m
[31m-        .data_in_num = I2S_PIN_NO_CHANGE[m
[31m-    };[m
[31m-[m
[31m-    i2s_driver_install(I2S_NUM, &config, 0, NULL);[m
[31m-    i2s_set_pin(I2S_NUM, &pins);[m
[31m-[m
[31m-    xTaskCreatePinnedToCore(i2s_task, "i2s_task", 4096, NULL, 5, NULL, 1);[m
[31m-}[m
[32m+[m[32mvoid audio_engine_init(audio_sink_t *out);[m
[32m+[m[32mvoid audio_engine_write(const uint8_t *data, size_t len);[m
[32m+[m[32msize_t audio_engine_read(uint8_t *data, size_t len);[m
 [m
[1mdiff --git a/core/audio/buffer/audio_ringbuf.c b/core/audio/buffer/audio_ringbuf.c[m
[1mindex 09ede87..efee68a 100644[m
[1m--- a/core/audio/buffer/audio_ringbuf.c[m
[1m+++ b/core/audio/buffer/audio_ringbuf.c[m
[36m@@ -4,16 +4,21 @@[m
 [m
 static uint8_t *buffer;[m
 static size_t buf_size;[m
[31m-static size_t write_pos;[m
[31m-static size_t read_pos;[m
[32m+[m[32mstatic volatile size_t write_pos;[m
[32m+[m[32mstatic volatile size_t read_pos;[m
 [m
 void audio_rb_init(size_t size) {[m
[32m+[m[32m    if (buffer) {[m
[32m+[m[32m        free(buffer);[m
[32m+[m[32m    }[m
     buffer = malloc(size);[m
     buf_size = size;[m
     write_pos = read_pos = 0;[m
 }[m
 [m
 size_t audio_rb_write(const uint8_t *data, size_t len) {[m
[32m+[m[32m    if (!buffer || !data || buf_size == 0) return 0;[m
[32m+[m[41m    [m
     size_t written = 0;[m
     while (written < len) {[m
         size_t next = (write_pos + 1) % buf_size;[m
[36m@@ -25,6 +30,8 @@[m [msize_t audio_rb_write(const uint8_t *data, size_t len) {[m
 }[m
 [m
 size_t audio_rb_read(uint8_t *data, size_t len) {[m
[32m+[m[32m    if (!buffer || !data || buf_size == 0) return 0;[m
[32m+[m
     size_t read = 0;[m
     while (read < len && read_pos != write_pos) {[m
         data[read++] = buffer[read_pos];[m
[36m@@ -32,3 +39,4 @@[m [msize_t audio_rb_read(uint8_t *data, size_t len) {[m
     }[m
     return read;[m
 }[m
[41m+[m
[1mdiff --git a/platforms